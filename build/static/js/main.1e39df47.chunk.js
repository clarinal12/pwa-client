(this["webpackJsonppwa-client"]=this["webpackJsonppwa-client"]||[]).push([[0],{111:function(e,t,n){},112:function(e,t,n){},116:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(74),i=n.n(o),c=n(49),l=n.n(c),s=n(58),u=n(19),m=n(91),d=n(21),f=n(34),p=n(93),v=n(79),g=n(92),b=n(7),w=n(80),E=n.n(w),h=n(84),S=n(83),O=n.n(S),k=n(85),j=function(){var e=Object(s.a)(l.a.mark((function e(){var t,n,a,r,o,i,c,s,u,w;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=new h.a({attempts:{max:1/0}}),n=new E.a,a=new p.a,r=Object(k.a)((function(e,t){var n=t.headers,a=localStorage.getItem("token");return{headers:Object(d.a)({},n,{authorization:a?"Bearer ".concat(a):""})}})),o=r.concat(a),window.addEventListener("offline",(function(){return n.close()})),window.addEventListener("online",(function(){return n.open()})),i=new O.a,c=new b.ApolloLink((function(e,t){if(void 0===t)return null;var n=e.getContext(),a=JSON.parse(window.localStorage.getItem("trackedQueries")||null)||[];if(void 0!==n.tracked){var r=e.operationName,o=e.query,i=e.variables,c={query:o,context:n,variables:i,operationName:r};window.localStorage.setItem("trackedQueries",JSON.stringify([].concat(Object(m.a)(a),[c])))}return t(e).map((function(e){return void 0!==n.tracked&&window.localStorage.setItem("trackedQueries",JSON.stringify(a)),e}))})),s=b.ApolloLink.from([c,n,i,t,o]),u=new g.a,w=new v.CachePersistor({cache:u,storage:window.localStorage}),"1"!==window.localStorage.getItem("apollo-schema-version")){e.next=18;break}return e.next=16,w.restore();case 16:e.next=21;break;case 18:return e.next=20,w.purge();case 20:window.localStorage.setItem("apollo-schema-version","1");case 21:return e.abrupt("return",new f.a({link:s,cache:u}));case 22:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),N=n(12),y=n(4),x=n(51),C=n(26),P=n(27),A=n.n(P);function I(){var e=Object(C.a)(["\n  query getMe {\n    me {\n      id\n      firstName\n      lastName\n      email\n      role\n      username\n      active\n    }\n  }\n"]);return I=function(){return e},e}var T=A()(I()),q=Object(a.createContext)({}),B=function(){return Object(a.useContext)(q)},L=function(e){var t=e.children,n=function(e){var t=Object(a.useState)(window.localStorage.getItem("token")),n=Object(u.a)(t,2),r=n[0],o=n[1],i=Object(a.useState)({}),c=Object(u.a)(i,2),l=c[0],s=c[1],m=Object(x.b)(T,{onCompleted:function(e){s(e.me)},notifyOnNetworkStatusChange:!0}),d=m.data,f=void 0===d?{}:d,p=m.refetch;Object(a.useEffect)((function(){f&&f.me&&r&&s(f.me)}),[l,f,r]);return{userToken:r,setUserToken:function(e){window.localStorage.setItem("token",e),o(e),p()},userDetails:l,signOut:function(){return new Promise((function(t){o(null),s({}),window.localStorage.clear(),e.clearStore(),t(!0)}))}}}(e.client);return r.a.createElement(q.Provider,{value:n},t)};n(110),n(111),n(112);function $(){var e=Object(C.a)(["\n  query ListStore {\n    listStore {\n      data {\n        id\n        description\n        address\n      }\n    }\n  }\n"]);return $=function(){return e},e}var R=A()($()),W=function(){var e=Object(x.b)(R,{fetchPolicy:"network-only"}),t=e.data,n=void 0===t?{}:t,a=e.loading,o=e.error,i=n.listStore,c=(void 0===i?{}:i).data,l=void 0===c?[]:c;return r.a.createElement("div",null,a&&r.a.createElement("div",{className:"text-center py-3"},r.a.createElement(y.ProgressCircular,{indeterminate:!0})),o&&r.a.createElement("div",{className:"text-center py-3"},o.message),r.a.createElement("div",{className:"grid grid-cols-2 gap-3 p-3"},l.map((function(e){var t=e.address,n=e.description,a=e.id;return r.a.createElement(y.Card,{modifier:"material",key:a,style:{margin:0}},r.a.createElement("p",{className:"text-2xl leading-tight"},n),r.a.createElement("p",{className:"mt-3"},t))}))))},J=n(69);function Q(){var e=Object(C.a)(["\n  mutation AddStore($description: String!, $address: String!) {\n    addStore(description: $description, address: $address) {\n      id\n      description\n      address\n    }\n  }\n"]);return Q=function(){return e},e}var U=A()(Q()),z=n(35),D=function(){return z.a().shape({description:z.b().required(),address:z.b().required()})},V=function(e){var t=e.onSuccess,n=e.initialValues,o=Object(a.useState)({open:!1,title:"",message:""}),i=Object(u.a)(o,2),c=i[0],l=i[1],s=Object(x.a)(U,{onCompleted:function(e){t(e)},onError:function(e){var t=e.message;l({open:!0,title:"Add Store Error",message:t})},refetchQueries:[{query:R}]}),m=Object(u.a)(s,2),f=m[0],p=m[1].loading,v=Object(J.a)({initialValues:Object(d.a)({description:"",address:""},n),onSubmit:function(e){var t=e.description,n=e.address;f({variables:{description:t,address:n}})},validationSchema:D,enableReinitialize:!0}),g=v.handleSubmit,b=v.handleChange;return r.a.createElement("div",null,c.open&&r.a.createElement(y.AlertDialog,{onCancel:function(){return l(Object(d.a)({},c,{open:!1}))},isOpen:!0,isCancelable:!0,modifier:"material"},r.a.createElement("div",{className:"alert-dialog-title"},c.title),r.a.createElement("div",{className:"alert-dialog-content"},c.message),r.a.createElement("div",null,r.a.createElement(y.Button,{onClick:function(){return l(Object(d.a)({},c,{open:!1}))},className:"alert-dialog-button"},"OK"))),r.a.createElement("form",null,r.a.createElement(y.Input,{float:!0,onChange:b,placeholder:"Description",name:"description",className:"w-full mt-4",modifier:"material"}),r.a.createElement(y.Input,{float:!0,onChange:b,placeholder:"Address",name:"address",className:"w-full mt-8",modifier:"material"}),r.a.createElement("div",{className:"mt-6 w-full text-right"},r.a.createElement(y.Button,{className:"w-full text-center",disabled:p,onClick:function(){return g()}},p?"Submitting...":"Submit"))))},F=function(e){var t=e.navigator,n=function(){t.popPage()};return r.a.createElement(y.Page,{renderToolbar:function(){return r.a.createElement(y.Toolbar,null,r.a.createElement("div",{className:"left"},r.a.createElement(y.BackButton,null)),r.a.createElement("div",{className:"center"},"Add Store"))}},r.a.createElement("div",{className:"content h-screen w-screen flex items-center justify-center"},r.a.createElement(V,{onSuccess:function(){return n()}})))},K=function(e){var t=e.title,n=e.navigator;return r.a.createElement(y.Page,{renderToolbar:function(){return r.a.createElement(y.Toolbar,null,r.a.createElement("div",{className:"center"},t))},renderFixed:function(){return r.a.createElement(y.Fab,{position:"top right",modifier:"mini",onClick:function(){n.pushPage({component:F,props:{key:"add-store"}})}},r.a.createElement("div",{className:"h-full w-full flex items-center justify-center"},r.a.createElement(y.Icon,{icon:"fa-plus",size:10})))}},r.a.createElement(W,null))},M=function(e){var t=e.title,n=(e.navigator,B().signOut);return r.a.createElement(y.Page,{renderToolbar:function(){return r.a.createElement(y.Toolbar,null,r.a.createElement("div",{className:"center"},t))}},r.a.createElement("div",{className:"content",style:{padding:20}},r.a.createElement("h1",null,"Accounts Screen"),r.a.createElement(y.Button,{onClick:function(){return n()}},"Logout")))};M.defaultProps={title:""};var G=[{label:"Stores",component:K,icon:"md-home"},{label:"Accounts",component:M,icon:"md-accounts"}],H=function(e){var t=e.navigator;return r.a.createElement(y.Page,null,r.a.createElement(y.Tabbar,{index:0,renderTabs:function(){return G.map((function(e,n){return{content:r.a.createElement(e.component,{key:n,title:e.label,navigator:t}),tab:r.a.createElement(y.Tab,{key:n,label:e.label,icon:e.icon})}}))}}))},X=function(){return r.a.createElement(y.Navigator,{initialRoute:{component:H,props:{key:"main"}},renderPage:function(e,t){return function(e,t){var n=e.props||{};return r.a.createElement(e.component,Object(d.a)({},n,{navigator:t}))}(e,t)}})};function Y(){var e=Object(C.a)(["\n  mutation Auth($username: String!, $password: String!) {\n    auth(username: $username, password: $password) {\n      token\n    }\n  }\n"]);return Y=function(){return e},e}var Z=A()(Y()),_=function(){return z.a().shape({username:z.b().required(),password:z.b().required()})},ee=function(){var e=Object(a.useState)({open:!1,title:"",message:""}),t=Object(u.a)(e,2),n=t[0],o=t[1],i=B().setUserToken,c=Object(x.a)(Z,{onCompleted:function(e){var t=e.auth;i(t.token)},onError:function(e){var t=e.message;o({open:!0,title:"Login Error",message:t})}}),l=Object(u.a)(c,2),s=l[0],m=l[1].loading,f=Object(J.a)({initialValues:{username:"",password:""},onSubmit:function(e){var t=e.username,n=e.password;s({variables:{username:t,password:n}})},validationSchema:_,enableReinitialize:!0}),p=f.handleSubmit,v=f.handleChange;return r.a.createElement("div",null,n.open&&r.a.createElement(y.AlertDialog,{onCancel:function(){return o(Object(d.a)({},n,{open:!1}))},isOpen:!0,isCancelable:!0,modifier:"material"},r.a.createElement("div",{className:"alert-dialog-title"},n.title),r.a.createElement("div",{className:"alert-dialog-content"},n.message),r.a.createElement("div",null,r.a.createElement(y.Button,{onClick:function(){return o(Object(d.a)({},n,{open:!1}))},className:"alert-dialog-button"},"OK"))),r.a.createElement("form",{className:"p-10"},r.a.createElement("h1",null,"Login"),r.a.createElement(y.Input,{float:!0,onChange:v,placeholder:"Username",name:"username",className:"w-full mt-4",modifier:"material"}),r.a.createElement(y.Input,{float:!0,onChange:v,placeholder:"Password",type:"password",name:"password",className:"w-full mt-8",modifier:"material"}),r.a.createElement("div",{className:"mt-6 w-full text-right"},r.a.createElement(y.Button,{className:"w-full text-center",disabled:m,onClick:function(){return p()}},m?"Submitting...":"Submit"))))},te=function(){return r.a.createElement(y.Page,null,r.a.createElement("div",{className:"content h-screen w-screen flex items-center justify-center"},r.a.createElement(ee,null)))},ne=function(){return B().userToken?r.a.createElement(X,null):r.a.createElement(te,null)},ae=function(e){var t=e.client;return e.loading?r.a.createElement("div",{className:"h-screen w-screen flex items-center justify-center"},r.a.createElement(y.ProgressCircular,{indeterminate:!0})):r.a.createElement(N.a,{client:t},r.a.createElement(N.a,{client:t},r.a.createElement(L,{client:t},r.a.createElement(ne,null))))};function re(){var e=Object(a.useState)(null),t=Object(u.a)(e,2),n=t[0],o=t[1],i=Object(a.useState)(!0),c=Object(u.a)(i,2),m=c[0],d=c[1];return Object(a.useEffect)((function(){j().then((function(e){o(e),setTimeout((function(){d(!1)}),1e3)}))}),[]),Object(a.useEffect)((function(){n&&function(){var e=Object(s.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=JSON.parse(window.localStorage.getItem("trackedQueries")||null)||[],a=t.map((function(e){var t=e.variables,a=e.query,r=e.context;return n.mutate({context:r,variables:t,mutation:a,optimisticResponse:r.optimisticResponse})})),e.prev=2,e.next=5,Promise.all(a);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log({error:e.t0});case 10:window.localStorage.setItem("trackedQueries","");case 11:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(){return e.apply(this,arguments)}}()()}),[n]),r.a.createElement(ae,{client:n,loading:m})}var oe=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ie(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}i.a.render(r.a.createElement(re,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("","/service-worker.js");oe?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):ie(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):ie(t,e)}))}}()},94:function(e,t,n){e.exports=n(116)}},[[94,1,2]]]);
//# sourceMappingURL=main.1e39df47.chunk.js.map